const data = {
    "name": "Jurisdictions",
    "children": [
      {
        "name": "ITU",
        "children": []
      },
      {
        "name": "ICES",
        "children": [
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1}
        ]
      },
      {
        "name": "ILO",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1}
        ]
      },
      {
        "name": "IHO",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1}
        ]
      },
      {
        "name": "WBG",
        "children": []
      },
      {
        "name": "IMF",
        "children": []
      },
      {
        "name": "FAO",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1}
        ]
      },
      {
        "name": "UNWTO",
        "children": []
      },
      {
        "name": "WMO",
        "children": []
      },
      {
        "name": "IMO Secretariat",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1}
        ]
      },
      {
        "name": "WHO",
        "children": []
      },
      {
        "name": "IOM",
        "children": []
      },
      {
        "name": "UNICEF",
        "children": []
      },
      {
        "name": "IAEA",
        "children": []
      },
      {
        "name": "UNOOSA",
        "children": []
      },
      {
        "name": "IOC",
        "children": [
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1},
          {"name": "The Area", "value": 1}
        ]
      },
      {
        "name": "OECD",
        "children": []
      },
      {
        "name": "WFP",
        "children": []
      },
      {
        "name": "UNRISD",
        "children": []
      },
      {
        "name": "UNCTAD",
        "children": []
      },
      {
        "name": "ITC",
        "children": []
      },
      {
        "name": "UNDP",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1}
        ]
      },
      {
        "name": "UNIDO",
        "children": []
      },
      {
        "name": "WIPO",
        "children": []
      },
      {
        "name": "UNFPA",
        "children": []
      },
      {
        "name": "Ramsar",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1}
        ]
      },
      {
        "name": "UNEP",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1}
        ]
      },
      {
        "name": "UNU",
        "children": []
      },
      {
        "name": "CITES",
        "children": []
      },
      {
        "name": "IFAD",
        "children": []
      },
      {
        "name": "UN-Habitat",
        "children": []
      },
      {
        "name": "CMS",
        "children": []
      },
      {
        "name": "IPCC",
        "children": []
      },
      {
        "name": "UN DOALOS",
        "children": [
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1},
          {"name": "The Area", "value": 1}
        ]
      },
      {
        "name": "UNFCCC",
        "children": []
      },
      {
        "name": "CBD",
        "children": [
          {"name": "Internal Waters", "value": 1},
          {"name": "Territorial Seas", "value": 1},
          {"name": "Archipelagic Waters", "value": 1},
          {"name": "Contiguous Zone", "value": 1},
          {"name": "EEZ", "value": 1},
          {"name": "Continental Shelf", "value": 1},
          {"name": "High Seas", "value": 1}
        ]
      },
      {
        "name": "OHCHR",
        "children": []
      },
      {
        "name": "ISA",
        "children": [
          {"name": "The Area", "value": 1}
        ]
      },
      {
        "name": "UNOPS",
        "children": []
      },
      {
        "name": "UNCCD",
        "children": []
      },
      {
        "name": "WTO",
        "children": []
      },
      {
        "name": "UNODC",
        "children": []
      },
      {
        "name": "UNDRR",
        "children": []
      },
      {
        "name": "UN Global Compact",
        "children": []
      },
      {
        "name": "UN-Women",
        "children": []
      },
      {
        "name": "IPBES",
        "children": []
      },
      {
        "name": "BRS",
        "children": []
      },
      {
        "name": "Minamata",
        "children": []
      }
    ]
  };
  
 // Function to categorize jurisdictions
function categorizeJurisdiction(name) {
    if (["Internal Waters", "Territorial Seas", "High Seas", "Archipelagic Waters"].includes(name)) {
      return "Water";
    } else if (["EEZ", "Continental Shelf"].includes(name)) {
      return "EEZ/Shelf";
    } else if (["The Area"].includes(name)) {
      return "The Area";
    } else {
      return "Other";
    }
  }
  
  // Group organizations without jurisdiction
  const groupedData = {
    "name": "Jurisdictions",
    "children": [
      ...data.children.filter(d => d.children.length > 0),  // Organizations with jurisdictions
      {
        "name": "No Jurisdiction",
        "children": data.children.filter(d => d.children.length === 0).map(org => ({ name: org.name, value: 1 }))
      }
    ]
  };
  
  const chart = () => {
    // Specify the dimensions of the chart.
    const width = 200;
    const height = 140;
    const margin = 3; // to avoid clipping the root circle stroke
  
    // Specify the number format for values.
    const format = d3.format(",d");
  
    // Create the pack layout.
    const pack = d3.pack()
        .size([width - margin * 2, height - margin * 2])
        .padding(2);
  
    // Compute the hierarchy from the JSON data; recursively sum the
    // values for each node; sort the tree by descending value; lastly
    // apply the pack layout.
    const root = pack(d3.hierarchy(groupedData)
        .sum(d => d.value ? d.value : 0)
        .sort((a, b) => b.value - a.value));
  
    // Create the SVG container.
    const svg = d3.create("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewBox", [-margin, -margin, width, height])
        .attr("style", "width: 100%; height: auto; font: 2px sans-serif;")
        .attr("text-anchor", "middle");
  
    // Prepare color scale for jurisdiction categories
    const color = d3.scaleOrdinal()
      .domain(["Water", "EEZ/Shelf", "The Area", "Other", "No Jurisdiction"])
      .range(["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd"]); // Example colors, adjust as needed
  
    // Place each node according to the layout’s x and y values.
    const node = svg.append("g")
      .selectAll()
      .data(root.descendants())
      .join("g")
        .attr("transform", d => `translate(${d.x},${d.y})`);
  
    // Add a title.
    node.append("title")
        .text(d => {
          if (d.children) {
            return d.data.name;
          } else {
            return `${d.data.name}\n${format(d.value)}\nCategory: ${categorizeJurisdiction(d.data.name)}`;
          }
        });
  
    // Add a filled circle, color based on jurisdiction category for leaf nodes or 'No Jurisdiction' for grouped orgs
    node.append("circle")
        .attr("fill", d => {
          if (d.data.name === "No Jurisdiction") return color("No Jurisdiction");
          if (d.children) return "#fff"; // Organization circles
          return color(categorizeJurisdiction(d.data.name));
        })
        .attr("stroke", d => d.children ? "#000" : "none")
        .attr("r", d => d.r);
  
    // Add labels for organizations and 'No Jurisdiction' group
    const label = node
      .filter(d => d.children || d.data.name === "No Jurisdiction")
      .append("text")
        .attr("clip-path", d => `circle(${d.r})`)
        .attr("dy", "0.3em")
        .style("font-size", "2px"); // Adjust font size as needed
  
    // For organizations and 'No Jurisdiction' group, split label into multiple lines if necessary
    label.selectAll()
      .data(d => d.data.name.split(/(?=[A-Z][a-z])|\s+/g))
      .join("tspan")
        .attr("x", 0)
        .attr("y", (d, i, nodes) => `${i - nodes.length / 2 + 0.35}em`)
        .text(d => d);
  
    // Add a label to leaf nodes (jurisdictions) only if there's space
    const text = node
      .filter(d => !d.children && d.data.name !== "No Jurisdiction" && d.r > 1)
      .append("text")
        .attr("clip-path", d => `circle(${d.r})`)
        .style("font-size", "1.0px"); // Adjust font size for leaf nodes
  
    // Add a tspan for each word in jurisdiction names
    text.selectAll()
      .data(d => d.data.name.split(/(?=[A-Z][a-z])|\s+/g))
      .join("tspan")
        .attr("x", 0)
        .attr("y", (d, i, nodes) => `${i - nodes.length / 2 + 0.35}em`)
        .text(d => d);
  
    // Add a tspan for the node’s value (for jurisdictions)
    text.append("tspan")
        .attr("x", 0)
        .attr("y", d => `${d.data.name.split(/(?=[A-Z][a-z])|\s+/g).length / 2 + 0.35}em`)
        .attr("fill-opacity", 0.0)
        .text(d => format(d.value));
  
    return svg.node();
  };
  
  // Append the chart to the body
  document.getElementById('chart').appendChild(chart());
  
  